<!-- Inicio del código HTML de la página de listado de notas -->

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Listado de Notas</title>
  <!-- Importar Tailwind CSS (usar CDN para fines ilustrativos) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-800 p-4">

  <!-- Buscador de notas -->
  <div class="mb-4">
    <label for="searchInput" class="block text-lg font-semibold mb-2">Buscar notas:</label>
    <input 
      type="text" 
      id="searchInput" 
      placeholder="Empieza a escribir para filtrar..." 
      class="w-full md:w-1/2 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" 
    />
  </div>

  <!-- Listado de notas -->
  <div>
    <h1 class="text-2xl font-bold mb-3">Notas disponibles</h1>
    <ul id="notesList" class="list-disc list-inside space-y-2 pl-4">
      <!-- Las notas se insertarán dinámicamente aquí como <li><a>...</a></li> -->
      <li class="text-gray-500">Cargando notas...</li>  <!-- Mensaje temporal mientras se cargan -->
    </ul>
  </div>

  <!-- Sección para agregar nueva nota -->
  <div class="mt-8 pt-4 border-t border-gray-300">
    <h2 class="text-xl font-semibold mb-3">¿Deseas agregar una nueva nota?</h2>
    <p class="mb-4">Haz clic en el siguiente botón para crear una nueva nota (archivo <code>.md</code>) en el repositorio:</p>
    <a href="https://github.com/sgevatschnaider/sgevatschnaider.github.io/new/main?filename=TuNuevaNota.md" target="_blank" 
       class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded">
      Agregar nueva nota
    </a>
  </div>

  <!-- Script para obtener archivos Markdown y manejar filtrado -->
  <script>
    // Elementos del DOM
    const notesList = document.getElementById('notesList');
    const searchInput = document.getElementById('searchInput');

    // Función para crear un elemento de lista por cada nota
    function addNoteItem(name, url) {
      const li = document.createElement('li');
      li.className = "hover:underline";
      const link = document.createElement('a');
      link.href = url;
      link.textContent = name;
      link.target = "_blank";
      link.rel = "noopener noreferrer";  // Buena práctica de seguridad con target=_blank
      link.className = "text-blue-600 hover:underline";
      li.appendChild(link);
      notesList.appendChild(li);
    }

    // Función recursiva para buscar archivos .md (en caso de subdirectorios)
    async function fetchMarkdownFiles(apiUrl) {
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        for (const item of data) {
          if (item.type === "file" && item.name.endsWith(".md")) {
            // Agregar la nota a la lista (item.html_url es la URL al archivo en GitHub)
            addNoteItem(item.name, item.html_url);
          } else if (item.type === "dir") {
            // Si es un directorio, explorar su contenido recursivamente
            await fetchMarkdownFiles(item.url);
          }
        }
      } catch (error) {
        console.error("Error al obtener contenido del repositorio:", error);
      }
    }

    // Llamar a la API de GitHub para obtener contenido del repositorio (raíz)
    (async function loadNotes() {
      // Vaciar la lista (remover mensaje de "Cargando")
      notesList.innerHTML = "";
      // Llamar a la función recursiva en la raíz del repositorio
      const apiRoot = "https://api.github.com/repos/sgevatschnaider/sgevatschnaider.github.io/contents/";
      await fetchMarkdownFiles(apiRoot);
      // Si no se encontró ninguna nota, mostrar mensaje
      if (!notesList.hasChildNodes()) {
        const msg = document.createElement('li');
        msg.textContent = "No se encontraron notas.";
        notesList.appendChild(msg);
      }
    })();

    // Evento de filtrado de la lista en tiempo real
    searchInput.addEventListener('input', function() {
      const filter = this.value.toLowerCase();
      const listItems = notesList.getElementsByTagName('li');
      for (let i = 0; i < listItems.length; i++) {
        const li = listItems[i];
        const text = li.textContent.toLowerCase();
        // Mostrar u ocultar según coincidencia de texto
        li.style.display = text.includes(filter) ? "" : "none";
      }
    });
  </script>

</body>
</html>

<!-- Fin del código HTML -->
